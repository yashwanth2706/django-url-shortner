{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Shortener</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap icons + Tooltip init -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{% static 'css/preset.css' %}">
  <!-- body and card rulsets can be found in preset.css -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <div class="card w-100" style="max-width: 450px;">
    <div class="card-body">
      <h5 class="card-title text-left mt-4">Shorten a long URL</h5>

    <!-- URL Form -->
    <div id="form-section" {% if short_url %}style="display:none;"{% endif %}>
      <form method="post" class="d-flex flex-column" id="urlForm">
        {% csrf_token %}

        <!-- Long URL input -->
        <div class="mb-3">
            {{ form.original_url }}
            {% if form.original_url.errors %}
            <div class="text-danger small">{{ form.original_url.errors.0 }}</div>
            {% endif %}
            <div id="urlError" style="display:none;">
            <div class="alert alert-danger p-2 mb-2" role="alert">
              Please enter a valid URL (e.g. https://example.com).
            </div>
            </div>
        </div>
        <h5 class="card-title text-left mt-4">Customize your link</h5>
        <!-- Alias input -->
        <div class="mb-3">
            {{ form.short_code }}
            <small class="form-text text-muted">
            Optional: Enter a custom alias (e.g. "my-link"). Leave blank for random.
            </small>
            {% if form.short_code.errors %}
            <div class="text-danger small">{{ form.short_code.errors.0 }}</div>
            {% endif %}
            <div id="aliasError" class="text-danger small" style="display:none;"></div>
        </div>
        <!-- Input Vaidation -->
        <script src="{% static 'js/inputValidation.js' %}"></script>        <!--
          IMPORTANT: Client-side validation might be bypassed by attackers.
          Server side validation added for extra security!
        -->
        <button type="submit" class="btn btn-success w-100 mt-3">Shorten URL</button>
      </form>
    </div>

      <!-- Result Section -->
      <div id="result-section" {% if not short_url %}style="display:none;"{% endif %}>
        {% if short_url %}
          <label>Your Long URL</label>
          <input type="text" class="form-control mb-2" value="{{ form.cleaned_data.original_url }}" readonly>

          <label>Short URL</label>
          <input type="text" id="shortUrlResult" class="form-control mb-3" value="{{ short_url }}" readonly>

          <div class="d-flex justify-content-between mb-3">
            <a href="{{ short_url }}" target="_blank" class="btn btn-outline-primary btn-sm" data-bs-toggle="tooltip" title="Visit URL">â†—</a>
            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="tooltip" title="Generate QR">QR</button>
            <button class="btn btn-outline-info btn-sm" data-bs-toggle="tooltip" title="Share">Share</button>
            <button type="button" class="btn btn-outline-success btn-sm" data-bs-toggle="tooltip" title="Copy" id="copyBtn">Copy</button>
          </div>

          <div class="d-flex justify-content-center">
            <a href="{% url 'index' %}" class="btn btn-success">Shorten another</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
<!-- Features card -->
<div class="card ms-5">
  <div class="card-header">
    Features
  </div>
  <div class="card-body">
    <h5 class="card-title">Manage your URLs Effortlessly</h5>
    <ul class="list-group m-2">
        <li class="list-group-item">Custom short links & aliases</li>
        <li class="list-group-item">QR code generation for each URL</li>
        <li class="list-group-item">Easy copy & share options</li>
        <li class="list-group-item">Manage and edit your URLs</li>
        <li class="list-group-item">Delete unwanted links</li>
    </ul>
    <div class="d-flex justify-content-end">
      <button id="my_urls" data-recent-urls-url="{% url 'recent_urls' %}" class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">My URLs</button>
    </div>
    <!--
    data-recent-urls-url="{% url 'recent_urls' %}"
    Above is an HTML5 spec
    BECOMES : element.dataset.recentUrlsUrl (Used in recentURLs.js with `fetch` function)
    HTML => JS attribute mapping

    The mapping rule data-*

    HTML attribute: data-foo-bar="123"

    JavaScript: element.dataset.fooBar === "123"

    So:

    data-recent-urls-url="..." => becomes element.dataset.recentUrlsUrl

    data-user-id="42" => becomes element.dataset.userId

    data-bs-toggle="tooltip" (Bootstrap) => becomes element.dataset.bsToggle
    -->
  </div>
</div>

<!-- Offcanvas right -->
<div class="offcanvas offcanvas-end offcanvas-wider" tabindex="-1" id="offcanvasRight"
     aria-labelledby="offcanvasRightLabel">
  <div class="offcanvas-header">
    <h5 id="offcanvasRightLabel">Your recent URLs</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <!-- Example URL Item -->
    <div id="recent-urls-list">
      <!-- Recent URLs will be loaded here by JS -->
    </div>
<!-- 
    This Bootstrap 5 Modal structure uses standard Bootstrap utilities 
    and the required IDs for integration with recentURLs_modal.js.
-->
<div class="modal fade" id="editUrlModal" tabindex="-1" aria-labelledby="editUrlModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <!-- Using Bootstrap classes for rounded corners and shadow -->
        <div class="modal-content rounded-3 shadow">
            
            <!-- Modal Header -->
            <!-- Using bg-light, border-bottom, and Bootstrap padding -->
            <div class="modal-header bg-light border-bottom p-3">
                <!-- Relying on h5 default styling, removed Tailwind font classes -->
                <h5 class="modal-title" id="modalTitle">Edit URL</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <!-- Modal Body and Form -->
            <form id="editUrlForm">
                <div class="modal-body p-4">
                    
                    <!-- Input Label and Field -->
                    <div class="mb-3">
                        <!-- Using Bootstrap text-muted for standard text color and size -->
                        <label for="editInputValue" id="modalLabel" class="form-label text-muted">Value:</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="editInputValue" 
                            placeholder="Enter new value"
                            required
                        >
                    </div>
                    
                    <!-- Inline Error Container (Initially hidden) -->
                    <!-- Using text-danger, small, and d-none for visibility control -->
                    <div id="modalError" class="text-danger small mt-2 d-none" role="alert">
                        <!-- Error messages from the server will appear here -->
                    </div>

                </div>
                
                <!-- Modal Footer -->
                <!-- Using d-flex and justify-content-end for button alignment -->
                <div class="modal-footer border-top p-3 d-flex justify-content-end">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="modalSaveBtn">Save Changes</button>
                </div>
            </form>
            
        </div>
    </div>
</div>
<!-- URL Edit/Rename Modal END -->
    <script src="{% static 'js/toolTip.js' %}"></script> 
    <script src="{% static 'js/recentURLs.js' %}"></script>
    <!-- More URL(s) if any, will be `fetch`ed via js and loaded here from recentURLs.js -->
  </div>
</div>
<!-- offcanvas-wider class can be found in preset.css to control width -->
  <script>

  </script>
  <script src="{% static 'js/inlineEditRecentURLs.js' %}"></script>        
</body>
</html>